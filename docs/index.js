"use strict";
class ComparisonPoset {
    constructor(humanValues, orderings = new Map()) {
        this.humanValues = humanValues;
        this.orderings = new Map();
        this.orderings = copy_map(orderings);
        if ([...orderings.values()].length == 0) {
            this.humanValues.map(v1 => {
                this.humanValues.map(v2 => {
                    this.orderings.set(combine_values(v1, v2), Comparison.Unknown);
                });
            });
        }
    }
    comparison(v1, v2) {
        return this.orderings.get(combine_values(v1, v2));
    }
    all_above(v1) {
        return this.humanValues.filter(v2 => this.comparison(v2, v1) == Comparison.GreaterThan);
    }
    all_below(v1) {
        return this.humanValues.filter(v2 => this.comparison(v1, v2) == Comparison.GreaterThan);
    }
    add_greater_than(higher, lower) {
        let higher_and_above = [higher].concat(this.all_above(higher));
        let lower_and_below = [lower].concat(this.all_below(lower));
        let o = copy_map(this.orderings);
        higher_and_above.map(v1 => {
            lower_and_below.map(v2 => {
                o.set(combine_values(v1, v2), Comparison.GreaterThan);
                o.set(combine_values(v2, v1), Comparison.LessThanOrEqual);
            });
        });
        return new ComparisonPoset(this.humanValues, o);
    }
    supremum(value) {
        let above = this.all_above(value);
        if (above.length > 0) {
            return this.supremum(above[0]);
        }
        return value;
    }
    print_valid() {
        return print_assignation(assign_ordering(this));
    }
    num_components() {
        return this.suprema().length;
    }
    suprema() {
        return [...new Set(this.humanValues.map(v => this.supremum(v)))];
    }
    estimate_questions_remaining(determine_top_n) {
        // How many questions to connect all components, then fully determine top n
        let questions_to_link_components = this.num_components() - 1;
        // Now work out how many questions once we have linked all components
        // Most likely scenario is binary tree
        let determined = this.fully_determined();
        let remaining = Math.max(determine_top_n - determined, 1);
        let questions_to_fill_top_spots_typical = remaining * (remaining - 1) / 2;
        let estimate = questions_to_link_components + 1 * questions_to_fill_top_spots_typical;
        return Math.floor(estimate) + 3; // plus 3 to be on the safe side
    }
    is_determined(value) {
        // Fully determined values have comparisons known everywhere, except against themselves
        return this.humanValues.filter(v2 => this.comparison(value, v2) == Comparison.Unknown).length == 1;
    }
    fully_determined() {
        // Number with no unknown entries (beside themselves)
        return this.humanValues.filter(v => this.is_determined(v)).length;
    }
    maximal_top_n(n) {
        return this.humanValues.filter(v => this.all_above(v).length < n);
    }
    _max_rating(value) {
        // 0-indexed, 0 means definitely at the top
        // rating of n means there are n definitely above this
        return this.humanValues.filter(v2 => this.comparison(v2, value) == Comparison.GreaterThan).length;
    }
    ratings(max) {
        let qualifying = this.humanValues.filter(v => this._max_rating(v) < max);
        return qualifying.map(v => new RatingInformation(v, this._max_rating(v), qualifying.filter(w => this.comparison(v, w) == Comparison.Unknown && (v != w))));
    }
}
function copy_map(ordering) {
    let o = new Map();
    [...ordering.keys()].map(k => {
        o.set(k, ordering.get(k));
    });
    return o;
}
class RatingInformation {
    constructor(value, rating, unknown_comparisons) {
        this.value = value;
        this.rating = rating;
        this.unknown_comparisons = unknown_comparisons;
    }
}
function assign_ordering(poset) {
    let assignation = new Map();
    poset.humanValues.map(value => assignation.set(value, Math.random()));
    let missmatch = function () {
        // Need to check that if a > b in the poset then a > b in the assignation
        for (let value of poset.humanValues) {
            let below = poset.all_below(value);
            let biggest_below = Math.max(...below.map(v => assignation.get(v)));
            if (assignation.get(value) <= biggest_below) {
                return true;
            }
        }
        return false;
    };
    let counter = 0;
    let max = 100;
    while (missmatch() && counter < max) {
        for (let value of poset.humanValues) {
            let below = poset.all_below(value);
            let biggest_below = Math.max(...below.map(v => assignation.get(v)));
            if (assignation.get(value) <= biggest_below) {
                assignation.set(value, biggest_below + (1 - biggest_below) * Math.random());
            }
        }
        counter++;
    }
    if (counter == max) {
        throw new Error("Timeout");
    }
    return assignation;
}
function print_assignation(assignation) {
    let values = [...assignation.keys()].sort((a, b) => assignation.get(a) - assignation.get(b));
    return values;
}
function combine_values(v1, v2) {
    return v1 + "::" + v2;
}
var Comparison;
(function (Comparison) {
    Comparison[Comparison["GreaterThan"] = 1] = "GreaterThan";
    Comparison[Comparison["LessThanOrEqual"] = -1] = "LessThanOrEqual";
    Comparison[Comparison["Unknown"] = 0] = "Unknown";
})(Comparison || (Comparison = {}));
function flip_comparison(comparison) {
    switch (comparison) {
        case Comparison.GreaterThan:
            return Comparison.LessThanOrEqual;
        case Comparison.LessThanOrEqual:
            return Comparison.GreaterThan;
        case Comparison.Unknown:
            return Comparison.Unknown;
    }
}
let Definitions = {
    "Adventure": "Finding new excitements",
    "Appearance": "Beauty, presence, and fashion",
    "Challenge": "Pushing yourself, regardless of the goal",
    "Community": "Being part of a large group",
    "Curiosity": "Encountering new ideas",
    "Dancing": "Alone or with others",
    "Emotional Independence": "Your mood is not reliant on the actions of others",
    "Exercise": "Things you do to keep fit",
    "Faith": "Connection to something beyond humanity",
    "Family": "Regular connection with family",
    "Fresh Air": "Access to a clean environment",
    "Friendship": "Deep relationships within a small group",
    "Games": "Boardgames, cards, computer games, etc.",
    "Learning": "Amassing knowledge and skills",
    "Love": "Finding people to share your heart with",
    "Peace": "Quiet surroundings or internal peace",
    "Pets": "Having pets at home",
    "Performing Arts": "Music, theatre, etc.",
    "Physical Independence": "Living without routine assistance",
    "Quiet Hobbies": "Occupied moments of calm",
    "Religion": "The routine, structure, and community, as opposed to Faith",
    "Reputation": "The things strangers might know you for",
    "Responsibility": "Being trusted by others",
    "Stability": "Confidence that next week will be like this week",
    "Sport": "Watching or taking part in",
    "Treats": "Indulging yourself",
    "Visual Arts and Crafts": "Creating or admiring",
    "Work": "Fulfilling employment",
};
let Values = [];
for (let key in Definitions) {
    Values.push(key);
}
class ValuesGame {
    constructor(max_interest) {
        this.max_interest = max_interest;
        this.poset_history = [];
        this.comparison_history = [];
        this.poset_history.push(new ComparisonPoset(Values));
    }
    poset() {
        // Top one is always most recent
        return this.poset_history[0];
    }
    of_interest() {
        let poset = this.poset();
        let suprema = poset.suprema();
        if (suprema.length > 1) {
            let first_choice = rFrom(suprema.map(v => [v, 1]));
            let second_choice = rFrom(suprema.filter(v => v != first_choice).map(v => [v, 1]));
            return [true, [first_choice, second_choice]];
        }
        let rating_info = this.poset().ratings(this.max_interest);
        let valid_competition = rating_info.filter(ri => ri.unknown_comparisons.length > 0);
        if (valid_competition.length == 0) {
            return [false, []];
        }
        let first_choice = rFrom(valid_competition.map(v => [v, 1 / (1 + v.rating)]));
        let second_choice = rFrom(first_choice.unknown_comparisons.map(v => [v, 1 / (1 + this.poset()._max_rating(v))]));
        return [true, [first_choice.value, second_choice]];
    }
    choose(v1, v2) {
        this.poset_history.unshift(this.poset().add_greater_than(v1, v2));
        this.comparison_history.unshift([v1, v2]);
        this.suggest();
    }
    suggest() {
        clear_choice_div();
        let pair = this.of_interest();
        if (pair[0] != false) {
            draw_choice(pair[1][0], pair[1][1]);
            draw_estimate(this.poset().estimate_questions_remaining(this.max_interest));
        }
        else {
            draw_assignment(this.poset().print_valid().reverse().slice(0, this.max_interest));
            hide_estimate();
        }
        draw_history(this.comparison_history);
    }
    undo() {
        if (this.poset_history.length > 1) {
            this.poset_history.shift();
            this.comparison_history.shift();
            hide_assignment();
        }
        this.suggest();
    }
    remaining() {
        return this.poset().estimate_questions_remaining(this.max_interest);
    }
}
function clear_history() {
    let div = document.getElementById("history");
    div.innerHTML = "";
}
function draw_history(comparisons) {
    clear_history();
    let div = document.getElementById("history");
    if (comparisons.length > 0) {
        let label = document.createElement("div");
        let undoButton = document.createElement("button");
        undoButton.addEventListener("click", ev => {
            VG.undo();
        });
        undoButton.innerText = "Undo Last";
        label.appendChild(undoButton);
        label.classList.add("three-wide");
        div.appendChild(label);
        comparisons.forEach(c => {
            let cp1 = document.createElement("div");
            let cp2 = document.createElement("div");
            let cp3 = document.createElement("div");
            cp1.innerText = c[0];
            cp2.textContent = ">";
            cp3.innerText = c[1];
            div.appendChild(cp1);
            div.appendChild(cp2);
            div.appendChild(cp3);
        });
    }
}
function clear_choice_div() {
    let div = document.getElementById("comparisons");
    div.innerHTML = "";
}
function hide_estimate() {
    let div = document.getElementById("estimate");
    div.classList.add("invisible");
    div.innerHTML = "";
}
function draw_estimate(estimate) {
    let div = document.getElementById("estimate");
    div.classList.remove("invisible");
    let estimate_text = estimate.toString();
    if (estimate < 10) {
        estimate_text = "Under 10";
    }
    div.innerHTML = `Estimated questions remaining: ${estimate_text}`;
}
function hide_assignment() {
    let div = document.getElementById("assignment");
    div.classList.add("invisible");
    div.innerHTML = "";
}
function draw_assignment(values) {
    let div = document.getElementById("assignment");
    div.classList.remove("invisible");
    div.innerHTML = `<h1>Your top values, ranked</h1>` + values.map(v => `<div class='valueReport'><h2>${v}</h2><p>${Definitions[v]}</p></div>`).join("\n");
}
function rFrom(weighted) {
    let total = (weighted.map(v => v[1])).reduce((a, b) => a + b);
    let r = Math.random() * total;
    while (r > 0) {
        let popped = weighted.pop();
        r -= popped[1];
        if (r < 0) {
            return popped[0];
        }
    }
    // Should never reach here
    throw new Error("Weighted list was empty");
}
function draw_choice(v1, v2) {
    let div = document.getElementById("comparisons");
    function button(v, w) {
        let b = document.createElement("button");
        b.innerText = v;
        b.addEventListener("click", ev => {
            VG.choose(v, w);
        });
        return b;
    }
    function mini_label(v) {
        let d = document.createElement("div");
        d.innerText = Definitions[v];
        d.classList.add("definition");
        return d;
    }
    let label = document.createElement("h1");
    label.classList.add("header");
    label.classList.add("two-wide");
    label.innerHTML = "Which is more important to you?";
    let explanation = document.createElement("div");
    explanation.classList.add("header");
    explanation.classList.add("two-wide");
    explanation.innerHTML = "Thinking about what you want from your day-to-day life";
    clear_choice_div();
    div.appendChild(label);
    div.appendChild(explanation);
    div.appendChild(button(v1, v2));
    div.appendChild(button(v2, v1));
    div.appendChild(mini_label(v1));
    div.appendChild(mini_label(v2));
}
let VG = new ValuesGame(5);
function start() {
    VG.suggest();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sZUFBZTtJQUVqQixZQUFxQixXQUFxQixFQUFFLFlBQXFDLElBQUksR0FBRyxFQUFFO1FBQXJFLGdCQUFXLEdBQVgsV0FBVyxDQUFVO1FBRDFDLGNBQVMsR0FBNEIsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUUxQyxJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNwQyxJQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUN0QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRTtvQkFDdEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQ2xFLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUE7U0FDTDtJQUNMLENBQUM7SUFDRCxVQUFVLENBQUMsRUFBVSxFQUFFLEVBQVU7UUFDN0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFlLENBQUE7SUFDbkUsQ0FBQztJQUNELFNBQVMsQ0FBQyxFQUFVO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDM0YsQ0FBQztJQUNELFNBQVMsQ0FB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RSxHQUFHLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzFCLFNBQVMsS0FBSztJQUNWLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtBQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ29tcGFyaXNvblBvc2V0IHtcbiAgICBvcmRlcmluZ3M6IE1hcDxzdHJpbmcsIENvbXBhcmlzb24+ID0gbmV3IE1hcCgpXG4gICAgY29uc3RydWN0b3IocmVhZG9ubHkgaHVtYW5WYWx1ZXM6IHN0cmluZ1tdLCBvcmRlcmluZ3M6IE1hcDxzdHJpbmcsIENvbXBhcmlzb24+ID0gbmV3IE1hcCgpKSB7XG4gICAgICAgIHRoaXMub3JkZXJpbmdzID0gY29weV9tYXAob3JkZXJpbmdzKVxuICAgICAgICBpZiAoWy4uLm9yZGVyaW5ncy52YWx1ZXMoKV0ubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuaHVtYW5WYWx1ZXMubWFwKHYxID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmh1bWFuVmFsdWVzLm1hcCh2MiA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3JkZXJpbmdzLnNldChjb21iaW5lX3ZhbHVlcyh2MSwgdjIpLCBDb21wYXJpc29uLlVua25vd24pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcGFyaXNvbih2MTogc3RyaW5nLCB2Mjogc3RyaW5nKTogQ29tcGFyaXNvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yZGVyaW5ncy5nZXQoY29tYmluZV92YWx1ZXModjEsIHYyKSkgYXMgQ29tcGFyaXNvblxuICAgIH1cbiAgICBhbGxfYWJvdmUodjE6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHVtYW5WYWx1ZXMuZmlsdGVyKHYyID0+IHRoaXMuY29tcGFyaXNvbih2MiwgdjEpID09IENvbXBhcmlzb24uR3JlYXRlclRoYW4pXG4gICAgfVxuICAgIGFsbF9iZWxvdyh2MTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodjIgPT4gdGhpcy5jb21wYXJpc29uKHYxLCB2MikgPT0gQ29tcGFyaXNvbi5HcmVhdGVyVGhhbilcbiAgICB9XG4gICAgYWRkX2dyZWF0ZXJfdGhhbihoaWdoZXI6IHN0cmluZywgbG93ZXI6IHN0cmluZyk6IENvbXBhcmlzb25Qb3NldCB7XG4gICAgICAgIGxldCBoaWdoZXJfYW5kX2Fib3ZlID0gW2hpZ2hlcl0uY29uY2F0KHRoaXMuYWxsX2Fib3ZlKGhpZ2hlcikpXG4gICAgICAgIGxldCBsb3dlcl9hbmRfYmVsb3cgPSBbbG93ZXJdLmNvbmNhdCh0aGlzLmFsbF9iZWxvdyhsb3dlcikpXG4gICAgICAgIGxldCBvID0gY29weV9tYXAodGhpcy5vcmRlcmluZ3MpXG4gICAgICAgIGhpZ2hlcl9hbmRfYWJvdmUubWFwKHYxID0+IHtcbiAgICAgICAgICAgIGxvd2VyX2FuZF9iZWxvdy5tYXAodjIgPT4ge1xuICAgICAgICAgICAgICAgIG8uc2V0KGNvbWJpbmVfdmFsdWVzKHYxLCB2MiksIENvbXBhcmlzb24uR3JlYXRlclRoYW4pXG4gICAgICAgICAgICAgICAgby5zZXQoY29tYmluZV92YWx1ZXModjIsIHYxKSwgQ29tcGFyaXNvbi5MZXNzVGhhbk9yRXF1YWwpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiBuZXcgQ29tcGFyaXNvblBvc2V0KHRoaXMuaHVtYW5WYWx1ZXMsIG8pXG4gICAgfVxuXG4gICAgc3VwcmVtdW0odmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGxldCBhYm92ZSA9IHRoaXMuYWxsX2Fib3ZlKHZhbHVlKVxuICAgICAgICBpZiAoYWJvdmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3VwcmVtdW0oYWJvdmVbMF0pXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuXG4gICAgcHJpbnRfdmFsaWQoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gcHJpbnRfYXNzaWduYXRpb24oYXNzaWduX29yZGVyaW5nKHRoaXMpKVxuICAgIH1cblxuICAgIG51bV9jb21wb25lbnRzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1cHJlbWEoKS5sZW5ndGhcbiAgICB9XG5cbiAgICBzdXByZW1hKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIFsuLi4gbmV3IFNldCh0aGlzLmh1bWFuVmFsdWVzLm1hcCh2ID0+IHRoaXMuc3VwcmVtdW0odikpKV1cbiAgICB9XG5cbiAgICBlc3RpbWF0ZV9xdWVzdGlvbnNfcmVtYWluaW5nKGRldGVybWluZV90b3BfbjogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgLy8gSG93IG1hbnkgcXVlc3Rpb25zIHRvIGNvbm5lY3QgYWxsIGNvbXBvbmVudHMsIHRoZW4gZnVsbHkgZGV0ZXJtaW5lIHRvcCBuXG4gICAgICAgIGxldCBxdWVzdGlvbnNfdG9fbGlua19jb21wb25lbnRzID0gdGhpcy5udW1fY29tcG9uZW50cygpIC0gMVxuXG4gICAgICAgIC8vIE5vdyB3b3JrIG91dCBob3cgbWFueSBxdWVzdGlvbnMgb25jZSB3ZSBoYXZlIGxpbmtlZCBhbGwgY29tcG9uZW50c1xuXG4gICAgICAgIC8vIE1vc3QgbGlrZWx5IHNjZW5hcmlvIGlzIGJpbmFyeSB0cmVlXG4gICAgICAgIGxldCBkZXRlcm1pbmVkID0gdGhpcy5mdWxseV9kZXRlcm1pbmVkKClcbiAgICAgICAgbGV0IHJlbWFpbmluZyA9IE1hdGgubWF4KGRldGVybWluZV90b3BfbiAtIGRldGVybWluZWQsIDEpXG4gICAgICAgIGxldCBxdWVzdGlvbnNfdG9fZmlsbF90b3Bfc3BvdHNfdHlwaWNhbCA9IHJlbWFpbmluZyAqIChyZW1haW5pbmcgLSAxKSAvIDJcblxuICAgICAgICBsZXQgZXN0aW1hdGUgPSBxdWVzdGlvbnNfdG9fbGlua19jb21wb25lbnRzICsgMSAqIHF1ZXN0aW9uc190b19maWxsX3RvcF9zcG90c190eXBpY2FsXG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKGVzdGltYXRlKSArIDMgLy8gcGx1cyAzIHRvIGJlIG9uIHRoZSBzYWZlIHNpZGVcbiAgICB9XG5cbiAgICBpc19kZXRlcm1pbmVkKHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgLy8gRnVsbHkgZGV0ZXJtaW5lZCB2YWx1ZXMgaGF2ZSBjb21wYXJpc29ucyBrbm93biBldmVyeXdoZXJlLCBleGNlcHQgYWdhaW5zdCB0aGVtc2VsdmVzXG4gICAgICAgIHJldHVybiB0aGlzLmh1bWFuVmFsdWVzLmZpbHRlcih2MiA9PiB0aGlzLmNvbXBhcmlzb24odmFsdWUsIHYyKSA9PSBDb21wYXJpc29uLlVua25vd24pLmxlbmd0aCA9PSAxXG4gICAgfVxuXG4gICAgZnVsbHlfZGV0ZXJtaW5lZCgpOiBudW1iZXIge1xuICAgICAgICAvLyBOdW1iZXIgd2l0aCBubyB1bmtub3duIGVudHJpZXMgKGJlc2lkZSB0aGVtc2VsdmVzKVxuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodiA9PiB0aGlzLmlzX2RldGVybWluZWQodikpLmxlbmd0aFxuICAgIH1cblxuICAgIG1heGltYWxfdG9wX24objogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodiA9PiB0aGlzLmFsbF9hYm92ZSh2KS5sZW5ndGggPCBuKVxuICAgIH1cblxuICAgIF9tYXhfcmF0aW5nKHZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xuICAgICAgICAvLyAwLWluZGV4ZWQsIDAgbWVhbnMgZGVmaW5pdGVseSBhdCB0aGUgdG9wXG4gICAgICAgIC8vIHJhdGluZyBvZiBuIG1lYW5zIHRoZXJlIGFyZSBuIGRlZmluaXRlbHkgYWJvdmUgdGhpc1xuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodjIgPT4gdGhpcy5jb21wYXJpc29uKHYyLCB2YWx1ZSkgPT0gQ29tcGFyaXNvbi5HcmVhdGVyVGhhbikubGVuZ3RoXG4gICAgfVxuXG4gICAgcmF0aW5ncyhtYXg6IG51bWJlcik6IFJhdGluZ0luZm9ybWF0aW9uW10ge1xuXG4gICAgICAgIGxldCBxdWFsaWZ5aW5nID0gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodiA9PiB0aGlzLl9tYXhfcmF0aW5nKHYpIDwgbWF4KVxuXG4gICAgICAgIHJldHVybiBxdWFsaWZ5aW5nLm1hcCh2ID0+IG5ldyBSYXRpbmdJbmZvcm1hdGlvbihcbiAgICAgICAgICAgIHYsXG4gICAgICAgICAgICB0aGlzLl9tYXhfcmF0aW5nKHYpLFxuICAgICAgICAgICAgcXVhbGlmeWluZy5maWx0ZXIodyA9PiB0aGlzLmNvbXBhcmlzb24odiwgdykgPT0gQ29tcGFyaXNvbi5Vbmtub3duICYmICh2ICE9IHcpKVxuICAgICAgICApKVxuICAgIH1cbn1cblxuZnVuY3Rpb24gY29weV9tYXA8SywgVj4ob3JkZXJpbmc6IE1hcDxLLCBWPik6IE1hcDxLLCBWPiB7XG4gICAgbGV0IG86IE1hcDxLLCBWPiA9IG5ldyBNYXAoKTtcbiAgICBbLi4ub3JkZXJpbmcua2V5cygpXS5tYXAoayA9PiB7XG4gICAgICAgIG8uc2V0KGssIG9yZGVyaW5nLmdldChrKSBhcyBWKVxuICAgIH0pXG4gICAgcmV0dXJuIG9cbn1cblxuY2xhc3MgUmF0aW5nSW5mb3JtYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHZhbHVlOiBzdHJpbmcsIHJlYWRvbmx5IHJhdGluZzogbnVtYmVyLCByZWFkb25seSB1bmtub3duX2NvbXBhcmlzb25zOiBzdHJpbmdbXSkgeyB9XG59XG5cbmZ1bmN0aW9uIGFzc2lnbl9vcmRlcmluZyhwb3NldDogQ29tcGFyaXNvblBvc2V0KTogTWFwPHN0cmluZywgbnVtYmVyPiB7XG4gICAgbGV0IGFzc2lnbmF0aW9uID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKVxuICAgIHBvc2V0Lmh1bWFuVmFsdWVzLm1hcCh2YWx1ZSA9PiBhc3NpZ25hdGlvbi5zZXQodmFsdWUsIE1hdGgucmFuZG9tKCkpKVxuICAgIGxldCBtaXNzbWF0Y2ggPSBmdW5jdGlvbiAoKTogQm9vbGVhbiB7XG4gICAgICAgIC8vIE5lZWQgdG8gY2hlY2sgdGhhdCBpZiBhID4gYiBpbiB0aGUgcG9zZXQgdGhlbiBhID4gYiBpbiB0aGUgYXNzaWduYXRpb25cbiAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgcG9zZXQuaHVtYW5WYWx1ZXMpIHtcbiAgICAgICAgICAgIGxldCBiZWxvdyA9IHBvc2V0LmFsbF9iZWxvdyh2YWx1ZSlcbiAgICAgICAgICAgIGxldCBiaWdnZXN0X2JlbG93ID0gTWF0aC5tYXgoLi4uYmVsb3cubWFwKHYgPT4gYXNzaWduYXRpb24uZ2V0KHYpIGFzIENvbXBhcmlzb24pKVxuICAgICAgICAgICAgaWYgKGFzc2lnbmF0aW9uLmdldCh2YWx1ZSkgYXMgQ29tcGFyaXNvbiA8PSBiaWdnZXN0X2JlbG93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgbGV0IGNvdW50ZXIgPSAwXG4gICAgbGV0IG1heCA9IDEwMFxuICAgIHdoaWxlIChtaXNzbWF0Y2goKSAmJiBjb3VudGVyIDwgbWF4KSB7XG4gICAgICAgIGZvciAobGV0IHZhbHVlIG9mIHBvc2V0Lmh1bWFuVmFsdWVzKSB7XG4gICAgICAgICAgICBsZXQgYmVsb3cgPSBwb3NldC5hbGxfYmVsb3codmFsdWUpXG4gICAgICAgICAgICBsZXQgYmlnZ2VzdF9iZWxvdyA9IE1hdGgubWF4KC4uLmJlbG93Lm1hcCh2ID0+IGFzc2lnbmF0aW9uLmdldCh2KSBhcyBudW1iZXIpKVxuICAgICAgICAgICAgaWYgKGFzc2lnbmF0aW9uLmdldCh2YWx1ZSkgYXMgbnVtYmVyIDw9IGJpZ2dlc3RfYmVsb3cpIHtcbiAgICAgICAgICAgICAgICBhc3NpZ25hdGlvbi5zZXQodmFsdWUsIGJpZ2dlc3RfYmVsb3cgKyAoMSAtIGJpZ2dlc3RfYmVsb3cpICogTWF0aC5yYW5kb20oKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb3VudGVyKytcbiAgICB9XG4gICAgaWYgKGNvdW50ZXIgPT0gbWF4KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRpbWVvdXRcIilcbiAgICB9XG4gICAgcmV0dXJuIGFzc2lnbmF0aW9uXG59XG5cbmZ1bmN0aW9uIHByaW50X2Fzc2lnbmF0aW9uKGFzc2lnbmF0aW9uOiBNYXA8c3RyaW5nLCBudW1iZXI+KTogc3RyaW5nW10ge1xuICAgIGxldCB2YWx1ZXMgPSBbLi4uYXNzaWduYXRpb24ua2V5cygpXS5zb3J0KChhLCBiKSA9PiAoYXNzaWduYXRpb24uZ2V0KGEpIGFzIG51bWJlcikgLSAoYXNzaWduYXRpb24uZ2V0KGIpIGFzIG51bWJlcikpXG4gICAgcmV0dXJuIHZhbHVlc1xufVxuXG5mdW5jdGlvbiBjb21iaW5lX3ZhbHVlcyh2MTogc3RyaW5nLCB2Mjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdjEgKyBcIjo6XCIgKyB2MlxufVxuXG5lbnVtIENvbXBhcmlzb24ge1xuICAgIEdyZWF0ZXJUaGFuID0gMSwgTGVzc1RoYW5PckVxdWFsID0gLTEsIFVua25vd24gPSAwXG59XG5cbmZ1bmN0aW9uIGZsaXBfY29tcGFyaXNvbihjb21wYXJpc29uOiBDb21wYXJpc29uKTogQ29tcGFyaXNvbiB7XG4gICAgc3dpdGNoIChjb21wYXJpc29uKSB7XG4gICAgICAgIGNhc2UgQ29tcGFyaXNvbi5HcmVhdGVyVGhhbjpcbiAgICAgICAgICAgIHJldHVybiBDb21wYXJpc29uLkxlc3NUaGFuT3JFcXVhbFxuICAgICAgICBjYXNlIENvbXBhcmlzb24uTGVzc1RoYW5PckVxdWFsOlxuICAgICAgICAgICAgcmV0dXJuIENvbXBhcmlzb24uR3JlYXRlclRoYW5cbiAgICAgICAgY2FzZSBDb21wYXJpc29uLlVua25vd246XG4gICAgICAgICAgICByZXR1cm4gQ29tcGFyaXNvbi5Vbmtub3duXG4gICAgfVxufVxuXG5cbmxldCBEZWZpbml0aW9ucyA9IHtcbiAgICBcIkFkdmVudHVyZVwiOiBcIkZpbmRpbmcgbmV3IGV4Y2l0ZW1lbnRzXCIsXG4gICAgXCJBcHBlYXJhbmNlXCI6IFwiQmVhdXR5LCBwcmVzZW5jZSwgYW5kIGZhc2hpb25cIixcbiAgICBcIkNoYWxsZW5nZVwiOiBcIlB1c2hpbmcgeW91cnNlbGYsIHJlZ2FyZGxlc3Mgb2YgdGhlIGdvYWxcIixcbiAgICBcIkNvbW11bml0eVwiOiBcIkJlaW5nIHBhcnQgb2YgYSBsYXJnZSBncm91cFwiLFxuICAgIFwiQ3VyaW9zaXR5XCI6IFwiRW5jb3VudGVyaW5nIG5ldyBpZGVhc1wiLFxuICAgIFwiRGFuY2luZ1wiOiBcIkFsb25lIG9yIHdpdGggb3RoZXJzXCIsXG4gICAgXCJFbW90aW9uYWwgSW5kZXBlbmRlbmNlXCI6IFwiWW91ciBtb29kIGlzIG5vdCByZWxpYW50IG9uIHRoZSBhY3Rpb25zIG9mIG90aGVyc1wiLFxuICAgIFwiRXhlcmNpc2VcIjogXCJUaGluZ3MgeW91IGRvIHRvIGtlZXAgZml0XCIsXG4gICAgXCJGYWl0aFwiOiBcIkNvbm5lY3Rpb24gdG8gc29tZXRoaW5nIGJleW9uZCBodW1hbml0eVwiLFxuICAgIFwiRmFtaWx5XCI6IFwiUmVndWxhciBjb25uZWN0aW9uIHdpdGggZmFtaWx5XCIsXG4gICAgXCJGcmVzaCBBaXJcIjogXCJBY2Nlc3MgdG8gYSBjbGVhbiBlbnZpcm9ubWVudFwiLFxuICAgIFwiRnJpZW5kc2hpcFwiOiBcIkRlZXAgcmVsYXRpb25zaGlwcyB3aXRoaW4gYSBzbWFsbCBncm91cFwiLFxuICAgIFwiR2FtZXNcIjogXCJCb2FyZGdhbWVzLCBjYXJkcywgY29tcHV0ZXIgZ2FtZXMsIGV0Yy5cIixcbiAgICBcIkxlYXJuaW5nXCI6IFwiQW1hc3Npbmcga25vd2xlZGdlIGFuZCBza2lsbHNcIixcbiAgICBcIkxvdmVcIjogXCJGaW5kaW5nIHBlb3BsZSB0byBzaGFyZSB5b3VyIGhlYXJ0IHdpdGhcIixcbiAgICBcIlBlYWNlXCI6IFwiUXVpZXQgc3Vycm91bmRpbmdzIG9yIGludGVybmFsIHBlYWNlXCIsXG4gICAgXCJQZXRzXCI6IFwiSGF2aW5nIHBldHMgYXQgaG9tZVwiLFxuICAgIFwiUGVyZm9ybWluZyBBcnRzXCI6IFwiTXVzaWMsIHRoZWF0cmUsIGV0Yy5cIixcbiAgICBcIlBoeXNpY2FsIEluZGVwZW5kZW5jZVwiOiBcIkxpdmluZyB3aXRob3V0IHJvdXRpbmUgYXNzaXN0YW5jZVwiLFxuICAgIFwiUXVpZXQgSG9iYmllc1wiOiBcIk9jY3VwaWVkIG1vbWVudHMgb2YgY2FsbVwiLFxuICAgIFwiUmVsaWdpb25cIjogXCJUaGUgcm91dGluZSwgc3RydWN0dXJlLCBhbmQgY29tbXVuaXR5LCBhcyBvcHBvc2VkIHRvIEZhaXRoXCIsXG4gICAgXCJSZXB1dGF0aW9uXCI6IFwiVGhlIHRoaW5ncyBzdHJhbmdlcnMgbWlnaHQga25vdyB5b3UgZm9yXCIsXG4gICAgXCJSZXNwb25zaWJpbGl0eVwiOiBcIkJlaW5nIHRydXN0ZWQgYnkgb3RoZXJzXCIsXG4gICAgXCJTdGFiaWxpdHlcIjogXCJDb25maWRlbmNlIHRoYXQgbmV4dCB3ZWVrIHdpbGwgYmUgbGlrZSB0aGlzIHdlZWtcIixcbiAgICBcIlNwb3J0XCI6IFwiV2F0Y2hpbmcgb3IgdGFraW5nIHBhcnQgaW5cIixcbiAgICBcIlRyZWF0c1wiOiBcIkluZHVsZ2luZyB5b3Vyc2VsZlwiLFxuICAgIFwiVmlzdWFsIEFydHMgYW5kIENyYWZ0c1wiOiBcIkNyZWF0aW5nIG9yIGFkbWlyaW5nXCIsXG4gICAgXCJXb3JrXCI6IFwiRnVsZmlsbGluZyBlbXBsb3ltZW50XCIsXG59XG5cbmxldCBWYWx1ZXM6IHN0cmluZ1tdID0gW11cbmZvciAobGV0IGtleSBpbiBEZWZpbml0aW9ucykge1xuICAgIFZhbHVlcy5wdXNoKGtleSlcbn1cblxuY2xhc3MgVmFsdWVzR2FtZSB7XG4gICAgcG9zZXRfaGlzdG9yeTogQ29tcGFyaXNvblBvc2V0W10gPSBbXVxuICAgIGNvbXBhcmlzb25faGlzdG9yeTogW3N0cmluZywgc3RyaW5nXVtdID0gW11cbiAgICBwb3NldCgpIHtcbiAgICAgICAgLy8gVG9wIG9uZSBpcyBhbHdheXMgbW9zdCByZWNlbnRcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zZXRfaGlzdG9yeVswXVxuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSBtYXhfaW50ZXJlc3Q6IG51bWJlcikge1xuICAgICAgICB0aGlzLnBvc2V0X2hpc3RvcnkucHVzaChuZXcgQ29tcGFyaXNvblBvc2V0KFZhbHVlcykpXG4gICAgfVxuICAgIG9mX2ludGVyZXN0KCk6IFtib29sZWFuLCBzdHJpbmdbXV0ge1xuICAgICAgICBsZXQgcG9zZXQgPSB0aGlzLnBvc2V0KClcbiAgICAgICAgbGV0IHN1cHJlbWEgPSBwb3NldC5zdXByZW1hKClcbiAgICAgICAgaWYgKHN1cHJlbWEubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgbGV0IGZpcnN0X2Nob2ljZSA9IHJGcm9tKHN1cHJlbWEubWFwKHYgPT4gW3YsIDFdKSlcbiAgICAgICAgICAgIGxldCBzZWNvbmRfY2hvaWNlID0gckZyb20oc3VwcmVtYS5maWx0ZXIodiA9PiB2ICE9IGZpcnN0X2Nob2ljZSkubWFwKHYgPT4gW3YsIDFdKSlcbiAgICAgICAgICAgIHJldHVybiBbdHJ1ZSwgW2ZpcnN0X2Nob2ljZSwgc2Vjb25kX2Nob2ljZV1dXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmF0aW5nX2luZm8gPSB0aGlzLnBvc2V0KCkucmF0aW5ncyh0aGlzLm1heF9pbnRlcmVzdClcbiAgICAgICAgbGV0IHZhbGlkX2NvbXBldGl0aW9uID0gcmF0aW5nX2luZm8uZmlsdGVyKHJpID0+IHJpLnVua25vd25fY29tcGFyaXNvbnMubGVuZ3RoID4gMClcbiAgICAgICAgaWYgKHZhbGlkX2NvbXBldGl0aW9uLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW2ZhbHNlLCBbXV1cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmaXJzdF9jaG9pY2UgPSByRnJvbSh2YWxpZF9jb21wZXRpdGlvbi5tYXAodiA9PiBbdiwgMSAvICgxICsgdi5yYXRpbmcpXSkpXG4gICAgICAgIGxldCBzZWNvbmRfY2hvaWNlID0gckZyb20oZmlyc3RfY2hvaWNlLnVua25vd25fY29tcGFyaXNvbnMubWFwKHYgPT4gW3YsIDEgLyAoMSArIHRoaXMucG9zZXQoKS5fbWF4X3JhdGluZyh2KSldKSlcbiAgICAgICAgcmV0dXJuIFt0cnVlLCBbZmlyc3RfY2hvaWNlLnZhbHVlLCBzZWNvbmRfY2hvaWNlXV1cbiAgICB9XG4gICAgY2hvb3NlKHYxOiBzdHJpbmcsIHYyOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5wb3NldF9oaXN0b3J5LnVuc2hpZnQodGhpcy5wb3NldCgpLmFkZF9ncmVhdGVyX3RoYW4odjEsIHYyKSlcbiAgICAgICAgdGhpcy5jb21wYXJpc29uX2hpc3RvcnkudW5zaGlmdChbdjEsIHYyXSlcbiAgICAgICAgdGhpcy5zdWdnZXN0KClcbiAgICB9XG4gICAgc3VnZ2VzdCgpOiB2b2lkIHtcbiAgICAgICAgY2xlYXJfY2hvaWNlX2RpdigpXG4gICAgICAgIGxldCBwYWlyID0gdGhpcy5vZl9pbnRlcmVzdCgpXG4gICAgICAgIGlmIChwYWlyWzBdICE9IGZhbHNlKSB7XG4gICAgICAgICAgICBkcmF3X2Nob2ljZShwYWlyWzFdWzBdLCBwYWlyWzFdWzFdKVxuICAgICAgICAgICAgZHJhd19lc3RpbWF0ZSh0aGlzLnBvc2V0KCkuZXN0aW1hdGVfcXVlc3Rpb25zX3JlbWFpbmluZyh0aGlzLm1heF9pbnRlcmVzdCkpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkcmF3X2Fzc2lnbm1lbnQodGhpcy5wb3NldCgpLnByaW50X3ZhbGlkKCkucmV2ZXJzZSgpLnNsaWNlKDAsIHRoaXMubWF4X2ludGVyZXN0KSlcbiAgICAgICAgICAgIGhpZGVfZXN0aW1hdGUoKVxuICAgICAgICB9XG4gICAgICAgIGRyYXdfaGlzdG9yeSh0aGlzLmNvbXBhcmlzb25faGlzdG9yeSlcbiAgICB9XG4gICAgdW5kbygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMucG9zZXRfaGlzdG9yeS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnBvc2V0X2hpc3Rvcnkuc2hpZnQoKVxuICAgICAgICAgICAgdGhpcy5jb21wYXJpc29uX2hpc3Rvcnkuc2hpZnQoKVxuICAgICAgICAgICAgaGlkZV9hc3NpZ25tZW50KClcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN1Z2dlc3QoKVxuICAgIH1cbiAgICByZW1haW5pbmcoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zZXQoKS5lc3RpbWF0ZV9xdWVzdGlvbnNfcmVtYWluaW5nKHRoaXMubWF4X2ludGVyZXN0KVxuICAgIH1cbn1cblxuZnVuY3Rpb24gY2xlYXJfaGlzdG9yeSgpIHtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJoaXN0b3J5XCIpXG4gICAgZGl2IS5pbm5lckhUTUwgPSBcIlwiXG59XG5cbmZ1bmN0aW9uIGRyYXdfaGlzdG9yeShjb21wYXJpc29uczogW3N0cmluZywgc3RyaW5nXVtdKSB7XG4gICAgY2xlYXJfaGlzdG9yeSgpXG5cbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJoaXN0b3J5XCIpXG4gICAgaWYgKGNvbXBhcmlzb25zLmxlbmd0aCA+IDApIHtcblxuICAgICAgICBsZXQgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICAgIGxldCB1bmRvQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKVxuICAgICAgICB1bmRvQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldiA9PiB7XG4gICAgICAgICAgICBWRy51bmRvKClcbiAgICAgICAgfSlcbiAgICAgICAgdW5kb0J1dHRvbi5pbm5lclRleHQgPSBcIlVuZG8gTGFzdFwiXG4gICAgICAgIGxhYmVsLmFwcGVuZENoaWxkKHVuZG9CdXR0b24pXG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoXCJ0aHJlZS13aWRlXCIpXG4gICAgICAgIGRpdiEuYXBwZW5kQ2hpbGQobGFiZWwpXG4gICAgICAgIGNvbXBhcmlzb25zLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgICBsZXQgY3AxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgICAgICAgICAgbGV0IGNwMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgICAgIGxldCBjcDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG5cbiAgICAgICAgICAgIGNwMS5pbm5lclRleHQgPSBjWzBdXG4gICAgICAgICAgICBjcDIudGV4dENvbnRlbnQgPSBcIj5cIlxuICAgICAgICAgICAgY3AzLmlubmVyVGV4dCA9IGNbMV1cblxuICAgICAgICAgICAgZGl2IS5hcHBlbmRDaGlsZChjcDEpXG4gICAgICAgICAgICBkaXYhLmFwcGVuZENoaWxkKGNwMilcbiAgICAgICAgICAgIGRpdiEuYXBwZW5kQ2hpbGQoY3AzKVxuICAgICAgICB9KVxuICAgIH1cbn1cblxuZnVuY3Rpb24gY2xlYXJfY2hvaWNlX2RpdigpIHtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb21wYXJpc29uc1wiKVxuICAgIGRpdiEuaW5uZXJIVE1MID0gXCJcIlxufVxuXG5cbmZ1bmN0aW9uIGhpZGVfZXN0aW1hdGUoKSB7XG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXN0aW1hdGVcIilcbiAgICBkaXYhLmNsYXNzTGlzdC5hZGQoXCJpbnZpc2libGVcIilcbiAgICBkaXYhLmlubmVySFRNTCA9IFwiXCJcbn1cblxuZnVuY3Rpb24gZHJhd19lc3RpbWF0ZShlc3RpbWF0ZTogbnVtYmVyKSB7XG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXN0aW1hdGVcIilcbiAgICBkaXYhLmNsYXNzTGlzdC5yZW1vdmUoXCJpbnZpc2libGVcIilcbiAgICBsZXQgZXN0aW1hdGVfdGV4dCA9IGVzdGltYXRlLnRvU3RyaW5nKClcbiAgICBpZiAoZXN0aW1hdGUgPCAxMCkge1xuICAgICAgICBlc3RpbWF0ZV90ZXh0ID0gXCJVbmRlciAxMFwiXG4gICAgfVxuICAgIGRpdiEuaW5uZXJIVE1MID0gYEVzdGltYXRlZCBxdWVzdGlvbnMgcmVtYWluaW5nOiAke2VzdGltYXRlX3RleHR9YFxufVxuXG5cblxuZnVuY3Rpb24gaGlkZV9hc3NpZ25tZW50KCkge1xuICAgIGxldCBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFzc2lnbm1lbnRcIilcbiAgICBkaXYhLmNsYXNzTGlzdC5hZGQoXCJpbnZpc2libGVcIilcbiAgICBkaXYhLmlubmVySFRNTCA9IFwiXCJcbn1cblxuZnVuY3Rpb24gZHJhd19hc3NpZ25tZW50KHZhbHVlczogc3RyaW5nW10pIHtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhc3NpZ25tZW50XCIpXG4gICAgZGl2IS5jbGFzc0xpc3QucmVtb3ZlKFwiaW52aXNpYmxlXCIpXG4gICAgZGl2IS5pbm5lckhUTUwgPSBgPGgxPllvdXIgdG9wIHZhbHVlcywgcmFua2VkPC9oMT5gICsgdmFsdWVzLm1hcCh2ID0+IGA8ZGl2IGNsYXNzPSd2YWx1ZVJlcG9ydCc+PGgyPiR7dn08L2gyPjxwPiR7KERlZmluaXRpb25zIGFzIGFueSlbdl19PC9wPjwvZGl2PmApLmpvaW4oXCJcXG5cIilcbn1cblxuZnVuY3Rpb24gckZyb208VD4od2VpZ2h0ZWQ6IFtULCBudW1iZXJdW10pOiBUIHtcbiAgICBsZXQgdG90YWwgPSAod2VpZ2h0ZWQubWFwKHYgPT4gdlsxXSkpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIpXG4gICAgbGV0IHIgPSBNYXRoLnJhbmRvbSgpICogdG90YWxcbiAgICB3aGlsZSAociA+IDApIHtcbiAgICAgICAgbGV0IHBvcHBlZCA9IHdlaWdodGVkLnBvcCgpIGFzIFtULCBudW1iZXJdXG4gICAgICAgIHIgLT0gcG9wcGVkWzFdXG4gICAgICAgIGlmIChyIDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuIHBvcHBlZFswXVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFNob3VsZCBuZXZlciByZWFjaCBoZXJlXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiV2VpZ2h0ZWQgbGlzdCB3YXMgZW1wdHlcIilcbn1cblxuZnVuY3Rpb24gZHJhd19jaG9pY2UodjE6IHN0cmluZywgdjI6IHN0cmluZykge1xuICAgIGxldCBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbXBhcmlzb25zXCIpXG4gICAgZnVuY3Rpb24gYnV0dG9uKHY6IHN0cmluZywgdzogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xuICAgICAgICBsZXQgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIilcbiAgICAgICAgYi5pbm5lclRleHQgPSB2XG4gICAgICAgIGIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ID0+IHtcbiAgICAgICAgICAgIFZHLmNob29zZSh2LCB3KVxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gYlxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1pbmlfbGFiZWwodjogc3RyaW5nKTogSFRNTEVsZW1lbnQge1xuICAgICAgICBsZXQgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgZC5pbm5lclRleHQgPSAoRGVmaW5pdGlvbnMgYXMgYW55KVt2XVxuICAgICAgICBkLmNsYXNzTGlzdC5hZGQoXCJkZWZpbml0aW9uXCIpXG4gICAgICAgIHJldHVybiBkXG4gICAgfVxuICAgIGxldCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMVwiKVxuICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoXCJoZWFkZXJcIilcbiAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKFwidHdvLXdpZGVcIilcbiAgICBsYWJlbC5pbm5lckhUTUwgPSBcIldoaWNoIGlzIG1vcmUgaW1wb3J0YW50IHRvIHlvdT9cIlxuICAgIGxldCBleHBsYW5hdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICBleHBsYW5hdGlvbi5jbGFzc0xpc3QuYWRkKFwiaGVhZGVyXCIpXG4gICAgZXhwbGFuYXRpb24uY2xhc3NMaXN0LmFkZChcInR3by13aWRlXCIpXG4gICAgZXhwbGFuYXRpb24uaW5uZXJIVE1MID0gXCJUaGlua2luZyBhYm91dCB3aGF0IHlvdSB3YW50IGZyb20geW91ciBkYXktdG8tZGF5IGxpZmVcIlxuICAgIGNsZWFyX2Nob2ljZV9kaXYoKVxuICAgIGRpdiEuYXBwZW5kQ2hpbGQobGFiZWwpXG4gICAgZGl2IS5hcHBlbmRDaGlsZChleHBsYW5hdGlvbilcbiAgICBkaXYhLmFwcGVuZENoaWxkKGJ1dHRvbih2MSwgdjIpKVxuICAgIGRpdiEuYXBwZW5kQ2hpbGQoYnV0dG9uKHYyLCB2MSkpXG4gICAgZGl2IS5hcHBlbmRDaGlsZChtaW5pX2xhYmVsKHYxKSlcbiAgICBkaXYhLmFwcGVuZENoaWxkKG1pbmlfbGFiZWwodjIpKVxufVxuXG5sZXQgVkcgPSBuZXcgVmFsdWVzR2FtZSg1KVxuZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgVkcuc3VnZ2VzdCgpXG59Il19