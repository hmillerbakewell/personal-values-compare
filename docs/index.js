"use strict";
class ComparisonPoset {
    constructor(humanValues, orderings = new Map()) {
        this.humanValues = humanValues;
        this.orderings = new Map();
        this.orderings = copy_map(orderings);
        if ([...orderings.values()].length == 0) {
            this.humanValues.map(v1 => {
                this.humanValues.map(v2 => {
                    this.orderings.set(combine_values(v1, v2), Comparison.Unknown);
                });
            });
        }
    }
    comparison(v1, v2) {
        return this.orderings.get(combine_values(v1, v2));
    }
    all_above(v1) {
        return this.humanValues.filter(v2 => this.comparison(v2, v1) == Comparison.GreaterThan);
    }
    all_below(v1) {
        return this.humanValues.filter(v2 => this.comparison(v1, v2) == Comparison.GreaterThan);
    }
    add_greater_than(higher, lower) {
        let higher_and_above = [higher].concat(this.all_above(higher));
        let lower_and_below = [lower].concat(this.all_below(lower));
        let o = copy_map(this.orderings);
        higher_and_above.map(v1 => {
            lower_and_below.map(v2 => {
                o.set(combine_values(v1, v2), Comparison.GreaterThan);
                o.set(combine_values(v2, v1), Comparison.LessThanOrEqual);
            });
        });
        return new ComparisonPoset(this.humanValues, o);
    }
    supremum(value) {
        let above = this.all_above(value);
        if (above.length > 0) {
            return this.supremum(above[0]);
        }
        return value;
    }
    print_valid() {
        return print_assignation(assign_ordering(this));
    }
    num_components() {
        return this.suprema().length;
    }
    suprema() {
        return [...new Set(this.humanValues.map(v => this.supremum(v)))];
    }
    estimate_questions_remaining(determine_top_n) {
        // How many questions to connect all components, then fully determine top n
        let questions_to_link_components = this.num_components() - 1;
        // Now work out how many questions once we have linked all components
        // Most likely scenario is binary tree
        let determined = this.fully_determined();
        let remaining = Math.max(determine_top_n - determined, 1);
        let questions_to_fill_top_spots_typical = remaining * (remaining - 1) / 2;
        let estimate = questions_to_link_components + 1.5 * questions_to_fill_top_spots_typical;
        return Math.floor(estimate) + 3; // plus 3 to be on the safe side
    }
    is_determined(value) {
        // Fully determined values have comparisons known everywhere, except against themselves
        return this.humanValues.filter(v2 => this.comparison(value, v2) == Comparison.Unknown).length == 1;
    }
    fully_determined() {
        // Number with no unknown entries (beside themselves)
        return this.humanValues.filter(v => this.is_determined(v)).length;
    }
    maximal_top_n(n) {
        return this.humanValues.filter(v => this.all_above(v).length < n);
    }
    _max_rating(value) {
        // 0-indexed, 0 means definitely at the top
        // rating of n means there are n definitely above this
        return this.humanValues.filter(v2 => this.comparison(v2, value) == Comparison.GreaterThan).length;
    }
    ratings(max) {
        let qualifying = this.humanValues.filter(v => this._max_rating(v) < max);
        return qualifying.map(v => new RatingInformation(v, this._max_rating(v), qualifying.filter(w => this.comparison(v, w) == Comparison.Unknown && (v != w))));
    }
}
function copy_map(ordering) {
    let o = new Map();
    [...ordering.keys()].map(k => {
        o.set(k, ordering.get(k));
    });
    return o;
}
class RatingInformation {
    constructor(value, rating, unknown_comparisons) {
        this.value = value;
        this.rating = rating;
        this.unknown_comparisons = unknown_comparisons;
    }
}
function assign_ordering(poset) {
    let assignation = new Map();
    poset.humanValues.map(value => assignation.set(value, Math.random()));
    let missmatch = function () {
        // Need to check that if a > b in the poset then a > b in the assignation
        for (let value of poset.humanValues) {
            let below = poset.all_below(value);
            let biggest_below = Math.max(...below.map(v => assignation.get(v)));
            if (assignation.get(value) <= biggest_below) {
                return true;
            }
        }
        return false;
    };
    let counter = 0;
    let max = 100;
    while (missmatch() && counter < max) {
        for (let value of poset.humanValues) {
            let below = poset.all_below(value);
            let biggest_below = Math.max(...below.map(v => assignation.get(v)));
            if (assignation.get(value) <= biggest_below) {
                assignation.set(value, biggest_below + (1 - biggest_below) * Math.random());
            }
        }
        counter++;
    }
    if (counter == max) {
        throw new Error("Timeout");
    }
    return assignation;
}
function print_assignation(assignation) {
    let values = [...assignation.keys()].sort((a, b) => assignation.get(a) - assignation.get(b));
    return values;
}
function combine_values(v1, v2) {
    return v1 + "::" + v2;
}
var Comparison;
(function (Comparison) {
    Comparison[Comparison["GreaterThan"] = 1] = "GreaterThan";
    Comparison[Comparison["LessThanOrEqual"] = -1] = "LessThanOrEqual";
    Comparison[Comparison["Unknown"] = 0] = "Unknown";
})(Comparison || (Comparison = {}));
function flip_comparison(comparison) {
    switch (comparison) {
        case Comparison.GreaterThan:
            return Comparison.LessThanOrEqual;
        case Comparison.LessThanOrEqual:
            return Comparison.GreaterThan;
        case Comparison.Unknown:
            return Comparison.Unknown;
    }
}
let Definitions = {
    "Adventure": "Finding new excitements",
    "Appearance": "Beauty, presence, and fashion",
    "Challenge": "Pushing yourself, regardless of the goal",
    "Community": "Being part of a large group",
    "Curiosity": "Encountering new ideas",
    "Cooking": "Preparing food in your own home",
    "Dancing": "Alone or with others",
    "Emotional Independence": "Your mood is not reliant on the actions of others",
    "Exercise": "Things you do to keep fit",
    "Faith": "Connection to something beyond humanity",
    "Family": "Regular connection with family",
    "Fresh Air": "Access to a clean environment",
    "Friendship": "Deep relationships within a small group",
    "Games": "Boardgames, cards, computer games, etc.",
    "Giving Gifts": "Finding or making gifts for others",
    "Helping Others": "Charity work or acts of service",
    "Learning": "Amassing knowledge and skills",
    "Love": "Finding people to share your heart with",
    "Peace": "Quiet surroundings or internal peace",
    "Pets": "Having pets at home",
    "Performing Arts": "Music, theatre, etc.",
    "Physical Independence": "Living without routine assistance",
    "Quiet Hobbies": "Occupied moments of calm",
    "Religion": "The routine, structure, and community, as opposed to Faith",
    "Reputation": "The things strangers might know you for",
    "Responsibility": "Being trusted by others",
    "Stability": "Confidence that next week will be like this week",
    "Sport": "Watching or taking part in",
    "Treats": "Indulging yourself",
    "Visual Arts and Crafts": "Creating or admiring",
    "Work": "Fulfilling employment",
};
let Values = [];
for (let key in Definitions) {
    Values.push(key);
}
class ValuesGame {
    constructor(max_interest) {
        this.max_interest = max_interest;
        this.poset_history = [];
        this.comparison_history = [];
        this.poset_history.push(new ComparisonPoset(Values));
    }
    poset() {
        // Top one is always most recent
        return this.poset_history[0];
    }
    of_interest() {
        let poset = this.poset();
        let suprema = poset.suprema();
        if (suprema.length > 1) {
            let first_choice = rFrom(suprema.map(v => [v, 1]));
            let second_choice = rFrom(suprema.filter(v => v != first_choice).map(v => [v, 1]));
            return [true, [first_choice, second_choice]];
        }
        let rating_info = this.poset().ratings(this.max_interest);
        let valid_competition = rating_info.filter(ri => ri.unknown_comparisons.length > 0);
        if (valid_competition.length == 0) {
            return [false, []];
        }
        let first_choice = rFrom(valid_competition.map(v => [v, 1 / (1 + v.rating)]));
        let second_choice = rFrom(first_choice.unknown_comparisons.map(v => [v, 1 / (1 + this.poset()._max_rating(v))]));
        return [true, [first_choice.value, second_choice]];
    }
    choose(v1, v2) {
        this.poset_history.unshift(this.poset().add_greater_than(v1, v2));
        this.comparison_history.unshift([v1, v2]);
        this.suggest();
    }
    suggest() {
        clear_choice_div();
        let pair = this.of_interest();
        if (pair[0] != false) {
            draw_choice(pair[1][0], pair[1][1]);
            draw_estimate(this.poset().estimate_questions_remaining(this.max_interest));
        }
        else {
            draw_assignment(this.poset().print_valid().reverse().slice(0, this.max_interest));
            hide_estimate();
        }
        draw_history(this.comparison_history);
    }
    undo() {
        if (this.poset_history.length > 1) {
            this.poset_history.shift();
            this.comparison_history.shift();
            hide_assignment();
        }
        this.suggest();
    }
    remaining() {
        return this.poset().estimate_questions_remaining(this.max_interest);
    }
}
function clear_history() {
    let div = document.getElementById("history");
    div.innerHTML = "";
}
function draw_history(comparisons) {
    clear_history();
    let div = document.getElementById("history");
    if (comparisons.length > 0) {
        let label = document.createElement("div");
        let undoButton = document.createElement("button");
        undoButton.addEventListener("click", ev => {
            VG.undo();
        });
        undoButton.innerText = "Undo Last";
        label.appendChild(undoButton);
        label.classList.add("three-wide");
        div.appendChild(label);
        comparisons.forEach(c => {
            let cp1 = document.createElement("div");
            let cp2 = document.createElement("div");
            let cp3 = document.createElement("div");
            cp1.innerText = c[0];
            cp2.textContent = ">";
            cp3.innerText = c[1];
            div.appendChild(cp1);
            div.appendChild(cp2);
            div.appendChild(cp3);
        });
    }
}
function clear_choice_div() {
    let div = document.getElementById("comparisons");
    div.innerHTML = "";
}
function hide_estimate() {
    let div = document.getElementById("estimate");
    div.classList.add("invisible");
    div.innerHTML = "";
}
function draw_estimate(estimate) {
    let div = document.getElementById("estimate");
    div.classList.remove("invisible");
    let estimate_text = estimate.toString();
    if (estimate < 10) {
        estimate_text = "Under 10";
    }
    div.innerHTML = `Estimated questions remaining: ${estimate_text}`;
}
function hide_assignment() {
    let div = document.getElementById("assignment");
    div.classList.add("invisible");
    div.innerHTML = "";
}
function draw_assignment(values) {
    let div = document.getElementById("assignment");
    div.classList.remove("invisible");
    div.innerHTML = `<h1>Your top values, ranked</h1>` + values.map(v => `<div class='valueReport'><h2>${v}</h2><p>${Definitions[v]}</p></div>`).join("\n");
}
function rFrom(weighted) {
    let total = (weighted.map(v => v[1])).reduce((a, b) => a + b);
    let r = Math.random() * total;
    while (r > 0) {
        let popped = weighted.pop();
        r -= popped[1];
        if (r < 0) {
            return popped[0];
        }
    }
    // Should never reach here
    throw new Error("Weighted list was empty");
}
function draw_choice(v1, v2) {
    let div = document.getElementById("comparisons");
    function button(v, w) {
        let b = document.createElement("button");
        b.innerText = v;
        b.addEventListener("click", ev => {
            VG.choose(v, w);
        });
        return b;
    }
    function mini_label(v) {
        let d = document.createElement("div");
        d.innerText = Definitions[v];
        d.classList.add("definition");
        return d;
    }
    let label = document.createElement("h1");
    label.classList.add("header");
    label.classList.add("two-wide");
    label.innerHTML = "Which is more important to you?";
    let explanation = document.createElement("div");
    explanation.classList.add("header");
    explanation.classList.add("two-wide");
    explanation.innerHTML = "Thinking about what you want from your day-to-day life";
    clear_choice_div();
    div.appendChild(label);
    div.appendChild(explanation);
    div.appendChild(button(v1, v2));
    div.appendChild(button(v2, v1));
    div.appendChild(mini_label(v1));
    div.appendChild(mini_label(v2));
}
let VG = new ValuesGame(5);
function start() {
    VG.suggest();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sZUFBZTtJQUVqQixZQUFxQixXQUFxQixFQUFFLFlBQXFDLElBQUksR0FBRyxFQUFFO1FBQXJFLGdCQUFXLEdBQVgsV0FBVyxDQUFVO1FBRDFDLGNBQVMsR0FBNEIsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUUxQyxJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNwQyxJQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUN0QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRTtvQkFDdEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQ2xFLENBQUMsQ0FBQyxDQUFBO1lBQ04sQ0FBQyxDQUFDLENBQUE7U0FDTDtJQUNMLENBQUM7SUFDRCxVQUFVLENBQUMsRUFBVSxFQUFFLEVBQVU7UUFDN0IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFlLENBQUE7SUFDbkUsQ0FBQztJQUNELFNBQVMsQ0FBQyxFQUFVO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDM0YsQ0FBQztJQUNELFNBQVMsQ0FB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SSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNwQyxDQUFDO0FBRUQsSUFBSSxFQUFFLEdBQUcsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDMUIsU0FBUyxLQUFLO0lBQ1YsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFBO0FBQ2hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBDb21wYXJpc29uUG9zZXQge1xuICAgIG9yZGVyaW5nczogTWFwPHN0cmluZywgQ29tcGFyaXNvbj4gPSBuZXcgTWFwKClcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSBodW1hblZhbHVlczogc3RyaW5nW10sIG9yZGVyaW5nczogTWFwPHN0cmluZywgQ29tcGFyaXNvbj4gPSBuZXcgTWFwKCkpIHtcbiAgICAgICAgdGhpcy5vcmRlcmluZ3MgPSBjb3B5X21hcChvcmRlcmluZ3MpXG4gICAgICAgIGlmIChbLi4ub3JkZXJpbmdzLnZhbHVlcygpXS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5odW1hblZhbHVlcy5tYXAodjEgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaHVtYW5WYWx1ZXMubWFwKHYyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmRlcmluZ3Muc2V0KGNvbWJpbmVfdmFsdWVzKHYxLCB2MiksIENvbXBhcmlzb24uVW5rbm93bilcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wYXJpc29uKHYxOiBzdHJpbmcsIHYyOiBzdHJpbmcpOiBDb21wYXJpc29uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3JkZXJpbmdzLmdldChjb21iaW5lX3ZhbHVlcyh2MSwgdjIpKSBhcyBDb21wYXJpc29uXG4gICAgfVxuICAgIGFsbF9hYm92ZSh2MTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodjIgPT4gdGhpcy5jb21wYXJpc29uKHYyLCB2MSkgPT0gQ29tcGFyaXNvbi5HcmVhdGVyVGhhbilcbiAgICB9XG4gICAgYWxsX2JlbG93KHYxOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh1bWFuVmFsdWVzLmZpbHRlcih2MiA9PiB0aGlzLmNvbXBhcmlzb24odjEsIHYyKSA9PSBDb21wYXJpc29uLkdyZWF0ZXJUaGFuKVxuICAgIH1cbiAgICBhZGRfZ3JlYXRlcl90aGFuKGhpZ2hlcjogc3RyaW5nLCBsb3dlcjogc3RyaW5nKTogQ29tcGFyaXNvblBvc2V0IHtcbiAgICAgICAgbGV0IGhpZ2hlcl9hbmRfYWJvdmUgPSBbaGlnaGVyXS5jb25jYXQodGhpcy5hbGxfYWJvdmUoaGlnaGVyKSlcbiAgICAgICAgbGV0IGxvd2VyX2FuZF9iZWxvdyA9IFtsb3dlcl0uY29uY2F0KHRoaXMuYWxsX2JlbG93KGxvd2VyKSlcbiAgICAgICAgbGV0IG8gPSBjb3B5X21hcCh0aGlzLm9yZGVyaW5ncylcbiAgICAgICAgaGlnaGVyX2FuZF9hYm92ZS5tYXAodjEgPT4ge1xuICAgICAgICAgICAgbG93ZXJfYW5kX2JlbG93Lm1hcCh2MiA9PiB7XG4gICAgICAgICAgICAgICAgby5zZXQoY29tYmluZV92YWx1ZXModjEsIHYyKSwgQ29tcGFyaXNvbi5HcmVhdGVyVGhhbilcbiAgICAgICAgICAgICAgICBvLnNldChjb21iaW5lX3ZhbHVlcyh2MiwgdjEpLCBDb21wYXJpc29uLkxlc3NUaGFuT3JFcXVhbClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG5ldyBDb21wYXJpc29uUG9zZXQodGhpcy5odW1hblZhbHVlcywgbylcbiAgICB9XG5cbiAgICBzdXByZW11bSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGFib3ZlID0gdGhpcy5hbGxfYWJvdmUodmFsdWUpXG4gICAgICAgIGlmIChhYm92ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdXByZW11bShhYm92ZVswXSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG5cbiAgICBwcmludF92YWxpZCgpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiBwcmludF9hc3NpZ25hdGlvbihhc3NpZ25fb3JkZXJpbmcodGhpcykpXG4gICAgfVxuXG4gICAgbnVtX2NvbXBvbmVudHMoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3VwcmVtYSgpLmxlbmd0aFxuICAgIH1cblxuICAgIHN1cHJlbWEoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gWy4uLiBuZXcgU2V0KHRoaXMuaHVtYW5WYWx1ZXMubWFwKHYgPT4gdGhpcy5zdXByZW11bSh2KSkpXVxuICAgIH1cblxuICAgIGVzdGltYXRlX3F1ZXN0aW9uc19yZW1haW5pbmcoZGV0ZXJtaW5lX3RvcF9uOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICAvLyBIb3cgbWFueSBxdWVzdGlvbnMgdG8gY29ubmVjdCBhbGwgY29tcG9uZW50cywgdGhlbiBmdWxseSBkZXRlcm1pbmUgdG9wIG5cbiAgICAgICAgbGV0IHF1ZXN0aW9uc190b19saW5rX2NvbXBvbmVudHMgPSB0aGlzLm51bV9jb21wb25lbnRzKCkgLSAxXG5cbiAgICAgICAgLy8gTm93IHdvcmsgb3V0IGhvdyBtYW55IHF1ZXN0aW9ucyBvbmNlIHdlIGhhdmUgbGlua2VkIGFsbCBjb21wb25lbnRzXG5cbiAgICAgICAgLy8gTW9zdCBsaWtlbHkgc2NlbmFyaW8gaXMgYmluYXJ5IHRyZWVcbiAgICAgICAgbGV0IGRldGVybWluZWQgPSB0aGlzLmZ1bGx5X2RldGVybWluZWQoKVxuICAgICAgICBsZXQgcmVtYWluaW5nID0gTWF0aC5tYXgoZGV0ZXJtaW5lX3RvcF9uIC0gZGV0ZXJtaW5lZCwgMSlcbiAgICAgICAgbGV0IHF1ZXN0aW9uc190b19maWxsX3RvcF9zcG90c190eXBpY2FsID0gcmVtYWluaW5nICogKHJlbWFpbmluZyAtIDEpIC8gMlxuXG4gICAgICAgIGxldCBlc3RpbWF0ZSA9IHF1ZXN0aW9uc190b19saW5rX2NvbXBvbmVudHMgKyAxLjUgKiBxdWVzdGlvbnNfdG9fZmlsbF90b3Bfc3BvdHNfdHlwaWNhbFxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihlc3RpbWF0ZSkgKyAzIC8vIHBsdXMgMyB0byBiZSBvbiB0aGUgc2FmZSBzaWRlXG4gICAgfVxuXG4gICAgaXNfZGV0ZXJtaW5lZCh2YWx1ZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIC8vIEZ1bGx5IGRldGVybWluZWQgdmFsdWVzIGhhdmUgY29tcGFyaXNvbnMga25vd24gZXZlcnl3aGVyZSwgZXhjZXB0IGFnYWluc3QgdGhlbXNlbHZlc1xuICAgICAgICByZXR1cm4gdGhpcy5odW1hblZhbHVlcy5maWx0ZXIodjIgPT4gdGhpcy5jb21wYXJpc29uKHZhbHVlLCB2MikgPT0gQ29tcGFyaXNvbi5Vbmtub3duKS5sZW5ndGggPT0gMVxuICAgIH1cblxuICAgIGZ1bGx5X2RldGVybWluZWQoKTogbnVtYmVyIHtcbiAgICAgICAgLy8gTnVtYmVyIHdpdGggbm8gdW5rbm93biBlbnRyaWVzIChiZXNpZGUgdGhlbXNlbHZlcylcbiAgICAgICAgcmV0dXJuIHRoaXMuaHVtYW5WYWx1ZXMuZmlsdGVyKHYgPT4gdGhpcy5pc19kZXRlcm1pbmVkKHYpKS5sZW5ndGhcbiAgICB9XG5cbiAgICBtYXhpbWFsX3RvcF9uKG46IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHVtYW5WYWx1ZXMuZmlsdGVyKHYgPT4gdGhpcy5hbGxfYWJvdmUodikubGVuZ3RoIDwgbilcbiAgICB9XG5cbiAgICBfbWF4X3JhdGluZyh2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAgICAgLy8gMC1pbmRleGVkLCAwIG1lYW5zIGRlZmluaXRlbHkgYXQgdGhlIHRvcFxuICAgICAgICAvLyByYXRpbmcgb2YgbiBtZWFucyB0aGVyZSBhcmUgbiBkZWZpbml0ZWx5IGFib3ZlIHRoaXNcbiAgICAgICAgcmV0dXJuIHRoaXMuaHVtYW5WYWx1ZXMuZmlsdGVyKHYyID0+IHRoaXMuY29tcGFyaXNvbih2MiwgdmFsdWUpID09IENvbXBhcmlzb24uR3JlYXRlclRoYW4pLmxlbmd0aFxuICAgIH1cblxuICAgIHJhdGluZ3MobWF4OiBudW1iZXIpOiBSYXRpbmdJbmZvcm1hdGlvbltdIHtcblxuICAgICAgICBsZXQgcXVhbGlmeWluZyA9IHRoaXMuaHVtYW5WYWx1ZXMuZmlsdGVyKHYgPT4gdGhpcy5fbWF4X3JhdGluZyh2KSA8IG1heClcblxuICAgICAgICByZXR1cm4gcXVhbGlmeWluZy5tYXAodiA9PiBuZXcgUmF0aW5nSW5mb3JtYXRpb24oXG4gICAgICAgICAgICB2LFxuICAgICAgICAgICAgdGhpcy5fbWF4X3JhdGluZyh2KSxcbiAgICAgICAgICAgIHF1YWxpZnlpbmcuZmlsdGVyKHcgPT4gdGhpcy5jb21wYXJpc29uKHYsIHcpID09IENvbXBhcmlzb24uVW5rbm93biAmJiAodiAhPSB3KSlcbiAgICAgICAgKSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNvcHlfbWFwPEssIFY+KG9yZGVyaW5nOiBNYXA8SywgVj4pOiBNYXA8SywgVj4ge1xuICAgIGxldCBvOiBNYXA8SywgVj4gPSBuZXcgTWFwKCk7XG4gICAgWy4uLm9yZGVyaW5nLmtleXMoKV0ubWFwKGsgPT4ge1xuICAgICAgICBvLnNldChrLCBvcmRlcmluZy5nZXQoaykgYXMgVilcbiAgICB9KVxuICAgIHJldHVybiBvXG59XG5cbmNsYXNzIFJhdGluZ0luZm9ybWF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSB2YWx1ZTogc3RyaW5nLCByZWFkb25seSByYXRpbmc6IG51bWJlciwgcmVhZG9ubHkgdW5rbm93bl9jb21wYXJpc29uczogc3RyaW5nW10pIHsgfVxufVxuXG5mdW5jdGlvbiBhc3NpZ25fb3JkZXJpbmcocG9zZXQ6IENvbXBhcmlzb25Qb3NldCk6IE1hcDxzdHJpbmcsIG51bWJlcj4ge1xuICAgIGxldCBhc3NpZ25hdGlvbiA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KClcbiAgICBwb3NldC5odW1hblZhbHVlcy5tYXAodmFsdWUgPT4gYXNzaWduYXRpb24uc2V0KHZhbHVlLCBNYXRoLnJhbmRvbSgpKSlcbiAgICBsZXQgbWlzc21hdGNoID0gZnVuY3Rpb24gKCk6IEJvb2xlYW4ge1xuICAgICAgICAvLyBOZWVkIHRvIGNoZWNrIHRoYXQgaWYgYSA+IGIgaW4gdGhlIHBvc2V0IHRoZW4gYSA+IGIgaW4gdGhlIGFzc2lnbmF0aW9uXG4gICAgICAgIGZvciAobGV0IHZhbHVlIG9mIHBvc2V0Lmh1bWFuVmFsdWVzKSB7XG4gICAgICAgICAgICBsZXQgYmVsb3cgPSBwb3NldC5hbGxfYmVsb3codmFsdWUpXG4gICAgICAgICAgICBsZXQgYmlnZ2VzdF9iZWxvdyA9IE1hdGgubWF4KC4uLmJlbG93Lm1hcCh2ID0+IGFzc2lnbmF0aW9uLmdldCh2KSBhcyBDb21wYXJpc29uKSlcbiAgICAgICAgICAgIGlmIChhc3NpZ25hdGlvbi5nZXQodmFsdWUpIGFzIENvbXBhcmlzb24gPD0gYmlnZ2VzdF9iZWxvdykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICAgIGxldCBjb3VudGVyID0gMFxuICAgIGxldCBtYXggPSAxMDBcbiAgICB3aGlsZSAobWlzc21hdGNoKCkgJiYgY291bnRlciA8IG1heCkge1xuICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiBwb3NldC5odW1hblZhbHVlcykge1xuICAgICAgICAgICAgbGV0IGJlbG93ID0gcG9zZXQuYWxsX2JlbG93KHZhbHVlKVxuICAgICAgICAgICAgbGV0IGJpZ2dlc3RfYmVsb3cgPSBNYXRoLm1heCguLi5iZWxvdy5tYXAodiA9PiBhc3NpZ25hdGlvbi5nZXQodikgYXMgbnVtYmVyKSlcbiAgICAgICAgICAgIGlmIChhc3NpZ25hdGlvbi5nZXQodmFsdWUpIGFzIG51bWJlciA8PSBiaWdnZXN0X2JlbG93KSB7XG4gICAgICAgICAgICAgICAgYXNzaWduYXRpb24uc2V0KHZhbHVlLCBiaWdnZXN0X2JlbG93ICsgKDEgLSBiaWdnZXN0X2JlbG93KSAqIE1hdGgucmFuZG9tKCkpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY291bnRlcisrXG4gICAgfVxuICAgIGlmIChjb3VudGVyID09IG1heCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaW1lb3V0XCIpXG4gICAgfVxuICAgIHJldHVybiBhc3NpZ25hdGlvblxufVxuXG5mdW5jdGlvbiBwcmludF9hc3NpZ25hdGlvbihhc3NpZ25hdGlvbjogTWFwPHN0cmluZywgbnVtYmVyPik6IHN0cmluZ1tdIHtcbiAgICBsZXQgdmFsdWVzID0gWy4uLmFzc2lnbmF0aW9uLmtleXMoKV0uc29ydCgoYSwgYikgPT4gKGFzc2lnbmF0aW9uLmdldChhKSBhcyBudW1iZXIpIC0gKGFzc2lnbmF0aW9uLmdldChiKSBhcyBudW1iZXIpKVxuICAgIHJldHVybiB2YWx1ZXNcbn1cblxuZnVuY3Rpb24gY29tYmluZV92YWx1ZXModjE6IHN0cmluZywgdjI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHYxICsgXCI6OlwiICsgdjJcbn1cblxuZW51bSBDb21wYXJpc29uIHtcbiAgICBHcmVhdGVyVGhhbiA9IDEsIExlc3NUaGFuT3JFcXVhbCA9IC0xLCBVbmtub3duID0gMFxufVxuXG5mdW5jdGlvbiBmbGlwX2NvbXBhcmlzb24oY29tcGFyaXNvbjogQ29tcGFyaXNvbik6IENvbXBhcmlzb24ge1xuICAgIHN3aXRjaCAoY29tcGFyaXNvbikge1xuICAgICAgICBjYXNlIENvbXBhcmlzb24uR3JlYXRlclRoYW46XG4gICAgICAgICAgICByZXR1cm4gQ29tcGFyaXNvbi5MZXNzVGhhbk9yRXF1YWxcbiAgICAgICAgY2FzZSBDb21wYXJpc29uLkxlc3NUaGFuT3JFcXVhbDpcbiAgICAgICAgICAgIHJldHVybiBDb21wYXJpc29uLkdyZWF0ZXJUaGFuXG4gICAgICAgIGNhc2UgQ29tcGFyaXNvbi5Vbmtub3duOlxuICAgICAgICAgICAgcmV0dXJuIENvbXBhcmlzb24uVW5rbm93blxuICAgIH1cbn1cblxuXG5sZXQgRGVmaW5pdGlvbnMgPSB7XG4gICAgXCJBZHZlbnR1cmVcIjogXCJGaW5kaW5nIG5ldyBleGNpdGVtZW50c1wiLFxuICAgIFwiQXBwZWFyYW5jZVwiOiBcIkJlYXV0eSwgcHJlc2VuY2UsIGFuZCBmYXNoaW9uXCIsXG4gICAgXCJDaGFsbGVuZ2VcIjogXCJQdXNoaW5nIHlvdXJzZWxmLCByZWdhcmRsZXNzIG9mIHRoZSBnb2FsXCIsXG4gICAgXCJDb21tdW5pdHlcIjogXCJCZWluZyBwYXJ0IG9mIGEgbGFyZ2UgZ3JvdXBcIixcbiAgICBcIkN1cmlvc2l0eVwiOiBcIkVuY291bnRlcmluZyBuZXcgaWRlYXNcIixcbiAgICBcIkNvb2tpbmdcIjogXCJQcmVwYXJpbmcgZm9vZCBpbiB5b3VyIG93biBob21lXCIsXG4gICAgXCJEYW5jaW5nXCI6IFwiQWxvbmUgb3Igd2l0aCBvdGhlcnNcIixcbiAgICBcIkVtb3Rpb25hbCBJbmRlcGVuZGVuY2VcIjogXCJZb3VyIG1vb2QgaXMgbm90IHJlbGlhbnQgb24gdGhlIGFjdGlvbnMgb2Ygb3RoZXJzXCIsXG4gICAgXCJFeGVyY2lzZVwiOiBcIlRoaW5ncyB5b3UgZG8gdG8ga2VlcCBmaXRcIixcbiAgICBcIkZhaXRoXCI6IFwiQ29ubmVjdGlvbiB0byBzb21ldGhpbmcgYmV5b25kIGh1bWFuaXR5XCIsXG4gICAgXCJGYW1pbHlcIjogXCJSZWd1bGFyIGNvbm5lY3Rpb24gd2l0aCBmYW1pbHlcIixcbiAgICBcIkZyZXNoIEFpclwiOiBcIkFjY2VzcyB0byBhIGNsZWFuIGVudmlyb25tZW50XCIsXG4gICAgXCJGcmllbmRzaGlwXCI6IFwiRGVlcCByZWxhdGlvbnNoaXBzIHdpdGhpbiBhIHNtYWxsIGdyb3VwXCIsXG4gICAgXCJHYW1lc1wiOiBcIkJvYXJkZ2FtZXMsIGNhcmRzLCBjb21wdXRlciBnYW1lcywgZXRjLlwiLFxuICAgIFwiR2l2aW5nIEdpZnRzXCI6IFwiRmluZGluZyBvciBtYWtpbmcgZ2lmdHMgZm9yIG90aGVyc1wiLFxuICAgIFwiSGVscGluZyBPdGhlcnNcIjogXCJDaGFyaXR5IHdvcmsgb3IgYWN0cyBvZiBzZXJ2aWNlXCIsXG4gICAgXCJMZWFybmluZ1wiOiBcIkFtYXNzaW5nIGtub3dsZWRnZSBhbmQgc2tpbGxzXCIsXG4gICAgXCJMb3ZlXCI6IFwiRmluZGluZyBwZW9wbGUgdG8gc2hhcmUgeW91ciBoZWFydCB3aXRoXCIsXG4gICAgXCJQZWFjZVwiOiBcIlF1aWV0IHN1cnJvdW5kaW5ncyBvciBpbnRlcm5hbCBwZWFjZVwiLFxuICAgIFwiUGV0c1wiOiBcIkhhdmluZyBwZXRzIGF0IGhvbWVcIixcbiAgICBcIlBlcmZvcm1pbmcgQXJ0c1wiOiBcIk11c2ljLCB0aGVhdHJlLCBldGMuXCIsXG4gICAgXCJQaHlzaWNhbCBJbmRlcGVuZGVuY2VcIjogXCJMaXZpbmcgd2l0aG91dCByb3V0aW5lIGFzc2lzdGFuY2VcIixcbiAgICBcIlF1aWV0IEhvYmJpZXNcIjogXCJPY2N1cGllZCBtb21lbnRzIG9mIGNhbG1cIixcbiAgICBcIlJlbGlnaW9uXCI6IFwiVGhlIHJvdXRpbmUsIHN0cnVjdHVyZSwgYW5kIGNvbW11bml0eSwgYXMgb3Bwb3NlZCB0byBGYWl0aFwiLFxuICAgIFwiUmVwdXRhdGlvblwiOiBcIlRoZSB0aGluZ3Mgc3RyYW5nZXJzIG1pZ2h0IGtub3cgeW91IGZvclwiLFxuICAgIFwiUmVzcG9uc2liaWxpdHlcIjogXCJCZWluZyB0cnVzdGVkIGJ5IG90aGVyc1wiLFxuICAgIFwiU3RhYmlsaXR5XCI6IFwiQ29uZmlkZW5jZSB0aGF0IG5leHQgd2VlayB3aWxsIGJlIGxpa2UgdGhpcyB3ZWVrXCIsXG4gICAgXCJTcG9ydFwiOiBcIldhdGNoaW5nIG9yIHRha2luZyBwYXJ0IGluXCIsXG4gICAgXCJUcmVhdHNcIjogXCJJbmR1bGdpbmcgeW91cnNlbGZcIixcbiAgICBcIlZpc3VhbCBBcnRzIGFuZCBDcmFmdHNcIjogXCJDcmVhdGluZyBvciBhZG1pcmluZ1wiLFxuICAgIFwiV29ya1wiOiBcIkZ1bGZpbGxpbmcgZW1wbG95bWVudFwiLFxufVxuXG5sZXQgVmFsdWVzOiBzdHJpbmdbXSA9IFtdXG5mb3IgKGxldCBrZXkgaW4gRGVmaW5pdGlvbnMpIHtcbiAgICBWYWx1ZXMucHVzaChrZXkpXG59XG5cbmNsYXNzIFZhbHVlc0dhbWUge1xuICAgIHBvc2V0X2hpc3Rvcnk6IENvbXBhcmlzb25Qb3NldFtdID0gW11cbiAgICBjb21wYXJpc29uX2hpc3Rvcnk6IFtzdHJpbmcsIHN0cmluZ11bXSA9IFtdXG4gICAgcG9zZXQoKSB7XG4gICAgICAgIC8vIFRvcCBvbmUgaXMgYWx3YXlzIG1vc3QgcmVjZW50XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2V0X2hpc3RvcnlbMF1cbiAgICB9XG4gICAgY29uc3RydWN0b3IocmVhZG9ubHkgbWF4X2ludGVyZXN0OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5wb3NldF9oaXN0b3J5LnB1c2gobmV3IENvbXBhcmlzb25Qb3NldChWYWx1ZXMpKVxuICAgIH1cbiAgICBvZl9pbnRlcmVzdCgpOiBbYm9vbGVhbiwgc3RyaW5nW11dIHtcbiAgICAgICAgbGV0IHBvc2V0ID0gdGhpcy5wb3NldCgpXG4gICAgICAgIGxldCBzdXByZW1hID0gcG9zZXQuc3VwcmVtYSgpXG4gICAgICAgIGlmIChzdXByZW1hLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGxldCBmaXJzdF9jaG9pY2UgPSByRnJvbShzdXByZW1hLm1hcCh2ID0+IFt2LCAxXSkpXG4gICAgICAgICAgICBsZXQgc2Vjb25kX2Nob2ljZSA9IHJGcm9tKHN1cHJlbWEuZmlsdGVyKHYgPT4gdiAhPSBmaXJzdF9jaG9pY2UpLm1hcCh2ID0+IFt2LCAxXSkpXG4gICAgICAgICAgICByZXR1cm4gW3RydWUsIFtmaXJzdF9jaG9pY2UsIHNlY29uZF9jaG9pY2VdXVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJhdGluZ19pbmZvID0gdGhpcy5wb3NldCgpLnJhdGluZ3ModGhpcy5tYXhfaW50ZXJlc3QpXG4gICAgICAgIGxldCB2YWxpZF9jb21wZXRpdGlvbiA9IHJhdGluZ19pbmZvLmZpbHRlcihyaSA9PiByaS51bmtub3duX2NvbXBhcmlzb25zLmxlbmd0aCA+IDApXG4gICAgICAgIGlmICh2YWxpZF9jb21wZXRpdGlvbi5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFtmYWxzZSwgW11dXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgZmlyc3RfY2hvaWNlID0gckZyb20odmFsaWRfY29tcGV0aXRpb24ubWFwKHYgPT4gW3YsIDEgLyAoMSArIHYucmF0aW5nKV0pKVxuICAgICAgICBsZXQgc2Vjb25kX2Nob2ljZSA9IHJGcm9tKGZpcnN0X2Nob2ljZS51bmtub3duX2NvbXBhcmlzb25zLm1hcCh2ID0+IFt2LCAxIC8gKDEgKyB0aGlzLnBvc2V0KCkuX21heF9yYXRpbmcodikpXSkpXG4gICAgICAgIHJldHVybiBbdHJ1ZSwgW2ZpcnN0X2Nob2ljZS52YWx1ZSwgc2Vjb25kX2Nob2ljZV1dXG4gICAgfVxuICAgIGNob29zZSh2MTogc3RyaW5nLCB2Mjogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMucG9zZXRfaGlzdG9yeS51bnNoaWZ0KHRoaXMucG9zZXQoKS5hZGRfZ3JlYXRlcl90aGFuKHYxLCB2MikpXG4gICAgICAgIHRoaXMuY29tcGFyaXNvbl9oaXN0b3J5LnVuc2hpZnQoW3YxLCB2Ml0pXG4gICAgICAgIHRoaXMuc3VnZ2VzdCgpXG4gICAgfVxuICAgIHN1Z2dlc3QoKTogdm9pZCB7XG4gICAgICAgIGNsZWFyX2Nob2ljZV9kaXYoKVxuICAgICAgICBsZXQgcGFpciA9IHRoaXMub2ZfaW50ZXJlc3QoKVxuICAgICAgICBpZiAocGFpclswXSAhPSBmYWxzZSkge1xuICAgICAgICAgICAgZHJhd19jaG9pY2UocGFpclsxXVswXSwgcGFpclsxXVsxXSlcbiAgICAgICAgICAgIGRyYXdfZXN0aW1hdGUodGhpcy5wb3NldCgpLmVzdGltYXRlX3F1ZXN0aW9uc19yZW1haW5pbmcodGhpcy5tYXhfaW50ZXJlc3QpKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZHJhd19hc3NpZ25tZW50KHRoaXMucG9zZXQoKS5wcmludF92YWxpZCgpLnJldmVyc2UoKS5zbGljZSgwLCB0aGlzLm1heF9pbnRlcmVzdCkpXG4gICAgICAgICAgICBoaWRlX2VzdGltYXRlKClcbiAgICAgICAgfVxuICAgICAgICBkcmF3X2hpc3RvcnkodGhpcy5jb21wYXJpc29uX2hpc3RvcnkpXG4gICAgfVxuICAgIHVuZG8oKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnBvc2V0X2hpc3RvcnkubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhpcy5wb3NldF9oaXN0b3J5LnNoaWZ0KClcbiAgICAgICAgICAgIHRoaXMuY29tcGFyaXNvbl9oaXN0b3J5LnNoaWZ0KClcbiAgICAgICAgICAgIGhpZGVfYXNzaWdubWVudCgpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdWdnZXN0KClcbiAgICB9XG4gICAgcmVtYWluaW5nKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2V0KCkuZXN0aW1hdGVfcXVlc3Rpb25zX3JlbWFpbmluZyh0aGlzLm1heF9pbnRlcmVzdClcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNsZWFyX2hpc3RvcnkoKSB7XG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGlzdG9yeVwiKVxuICAgIGRpdiEuaW5uZXJIVE1MID0gXCJcIlxufVxuXG5mdW5jdGlvbiBkcmF3X2hpc3RvcnkoY29tcGFyaXNvbnM6IFtzdHJpbmcsIHN0cmluZ11bXSkge1xuICAgIGNsZWFyX2hpc3RvcnkoKVxuXG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGlzdG9yeVwiKVxuICAgIGlmIChjb21wYXJpc29ucy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgbGV0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgICAgICBsZXQgdW5kb0J1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIilcbiAgICAgICAgdW5kb0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZXYgPT4ge1xuICAgICAgICAgICAgVkcudW5kbygpXG4gICAgICAgIH0pXG4gICAgICAgIHVuZG9CdXR0b24uaW5uZXJUZXh0ID0gXCJVbmRvIExhc3RcIlxuICAgICAgICBsYWJlbC5hcHBlbmRDaGlsZCh1bmRvQnV0dG9uKVxuICAgICAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKFwidGhyZWUtd2lkZVwiKVxuICAgICAgICBkaXYhLmFwcGVuZENoaWxkKGxhYmVsKVxuICAgICAgICBjb21wYXJpc29ucy5mb3JFYWNoKGMgPT4ge1xuICAgICAgICAgICAgbGV0IGNwMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgICAgIGxldCBjcDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICAgICAgICBsZXQgY3AzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuXG4gICAgICAgICAgICBjcDEuaW5uZXJUZXh0ID0gY1swXVxuICAgICAgICAgICAgY3AyLnRleHRDb250ZW50ID0gXCI+XCJcbiAgICAgICAgICAgIGNwMy5pbm5lclRleHQgPSBjWzFdXG5cbiAgICAgICAgICAgIGRpdiEuYXBwZW5kQ2hpbGQoY3AxKVxuICAgICAgICAgICAgZGl2IS5hcHBlbmRDaGlsZChjcDIpXG4gICAgICAgICAgICBkaXYhLmFwcGVuZENoaWxkKGNwMylcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNsZWFyX2Nob2ljZV9kaXYoKSB7XG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tcGFyaXNvbnNcIilcbiAgICBkaXYhLmlubmVySFRNTCA9IFwiXCJcbn1cblxuXG5mdW5jdGlvbiBoaWRlX2VzdGltYXRlKCkge1xuICAgIGxldCBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVzdGltYXRlXCIpXG4gICAgZGl2IS5jbGFzc0xpc3QuYWRkKFwiaW52aXNpYmxlXCIpXG4gICAgZGl2IS5pbm5lckhUTUwgPSBcIlwiXG59XG5cbmZ1bmN0aW9uIGRyYXdfZXN0aW1hdGUoZXN0aW1hdGU6IG51bWJlcikge1xuICAgIGxldCBkaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVzdGltYXRlXCIpXG4gICAgZGl2IS5jbGFzc0xpc3QucmVtb3ZlKFwiaW52aXNpYmxlXCIpXG4gICAgbGV0IGVzdGltYXRlX3RleHQgPSBlc3RpbWF0ZS50b1N0cmluZygpXG4gICAgaWYgKGVzdGltYXRlIDwgMTApIHtcbiAgICAgICAgZXN0aW1hdGVfdGV4dCA9IFwiVW5kZXIgMTBcIlxuICAgIH1cbiAgICBkaXYhLmlubmVySFRNTCA9IGBFc3RpbWF0ZWQgcXVlc3Rpb25zIHJlbWFpbmluZzogJHtlc3RpbWF0ZV90ZXh0fWBcbn1cblxuXG5cbmZ1bmN0aW9uIGhpZGVfYXNzaWdubWVudCgpIHtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhc3NpZ25tZW50XCIpXG4gICAgZGl2IS5jbGFzc0xpc3QuYWRkKFwiaW52aXNpYmxlXCIpXG4gICAgZGl2IS5pbm5lckhUTUwgPSBcIlwiXG59XG5cbmZ1bmN0aW9uIGRyYXdfYXNzaWdubWVudCh2YWx1ZXM6IHN0cmluZ1tdKSB7XG4gICAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXNzaWdubWVudFwiKVxuICAgIGRpdiEuY2xhc3NMaXN0LnJlbW92ZShcImludmlzaWJsZVwiKVxuICAgIGRpdiEuaW5uZXJIVE1MID0gYDxoMT5Zb3VyIHRvcCB2YWx1ZXMsIHJhbmtlZDwvaDE+YCArIHZhbHVlcy5tYXAodiA9PiBgPGRpdiBjbGFzcz0ndmFsdWVSZXBvcnQnPjxoMj4ke3Z9PC9oMj48cD4keyhEZWZpbml0aW9ucyBhcyBhbnkpW3ZdfTwvcD48L2Rpdj5gKS5qb2luKFwiXFxuXCIpXG59XG5cbmZ1bmN0aW9uIHJGcm9tPFQ+KHdlaWdodGVkOiBbVCwgbnVtYmVyXVtdKTogVCB7XG4gICAgbGV0IHRvdGFsID0gKHdlaWdodGVkLm1hcCh2ID0+IHZbMV0pKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKVxuICAgIGxldCByID0gTWF0aC5yYW5kb20oKSAqIHRvdGFsXG4gICAgd2hpbGUgKHIgPiAwKSB7XG4gICAgICAgIGxldCBwb3BwZWQgPSB3ZWlnaHRlZC5wb3AoKSBhcyBbVCwgbnVtYmVyXVxuICAgICAgICByIC09IHBvcHBlZFsxXVxuICAgICAgICBpZiAociA8IDApIHtcbiAgICAgICAgICAgIHJldHVybiBwb3BwZWRbMF1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBTaG91bGQgbmV2ZXIgcmVhY2ggaGVyZVxuICAgIHRocm93IG5ldyBFcnJvcihcIldlaWdodGVkIGxpc3Qgd2FzIGVtcHR5XCIpXG59XG5cbmZ1bmN0aW9uIGRyYXdfY2hvaWNlKHYxOiBzdHJpbmcsIHYyOiBzdHJpbmcpIHtcbiAgICBsZXQgZGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb21wYXJpc29uc1wiKVxuICAgIGZ1bmN0aW9uIGJ1dHRvbih2OiBzdHJpbmcsIHc6IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgbGV0IGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpXG4gICAgICAgIGIuaW5uZXJUZXh0ID0gdlxuICAgICAgICBiLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldiA9PiB7XG4gICAgICAgICAgICBWRy5jaG9vc2UodiwgdylcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtaW5pX2xhYmVsKHY6IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgbGV0IGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICAgIGQuaW5uZXJUZXh0ID0gKERlZmluaXRpb25zIGFzIGFueSlbdl1cbiAgICAgICAgZC5jbGFzc0xpc3QuYWRkKFwiZGVmaW5pdGlvblwiKVxuICAgICAgICByZXR1cm4gZFxuICAgIH1cbiAgICBsZXQgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIilcbiAgICBsYWJlbC5jbGFzc0xpc3QuYWRkKFwiaGVhZGVyXCIpXG4gICAgbGFiZWwuY2xhc3NMaXN0LmFkZChcInR3by13aWRlXCIpXG4gICAgbGFiZWwuaW5uZXJIVE1MID0gXCJXaGljaCBpcyBtb3JlIGltcG9ydGFudCB0byB5b3U/XCJcbiAgICBsZXQgZXhwbGFuYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgZXhwbGFuYXRpb24uY2xhc3NMaXN0LmFkZChcImhlYWRlclwiKVxuICAgIGV4cGxhbmF0aW9uLmNsYXNzTGlzdC5hZGQoXCJ0d28td2lkZVwiKVxuICAgIGV4cGxhbmF0aW9uLmlubmVySFRNTCA9IFwiVGhpbmtpbmcgYWJvdXQgd2hhdCB5b3Ugd2FudCBmcm9tIHlvdXIgZGF5LXRvLWRheSBsaWZlXCJcbiAgICBjbGVhcl9jaG9pY2VfZGl2KClcbiAgICBkaXYhLmFwcGVuZENoaWxkKGxhYmVsKVxuICAgIGRpdiEuYXBwZW5kQ2hpbGQoZXhwbGFuYXRpb24pXG4gICAgZGl2IS5hcHBlbmRDaGlsZChidXR0b24odjEsIHYyKSlcbiAgICBkaXYhLmFwcGVuZENoaWxkKGJ1dHRvbih2MiwgdjEpKVxuICAgIGRpdiEuYXBwZW5kQ2hpbGQobWluaV9sYWJlbCh2MSkpXG4gICAgZGl2IS5hcHBlbmRDaGlsZChtaW5pX2xhYmVsKHYyKSlcbn1cblxubGV0IFZHID0gbmV3IFZhbHVlc0dhbWUoNSlcbmZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgIFZHLnN1Z2dlc3QoKVxufSJdfQ==